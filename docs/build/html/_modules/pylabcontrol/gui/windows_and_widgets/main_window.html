
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pylabcontrol.gui.windows_and_widgets.main_window &#8212; pylabcontrol 0.1a3 documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.1a3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pylabcontrol.gui.windows_and_widgets.main_window</h1><div class="highlight"><pre>
<span></span><span class="c1"># This file is part of pylabcontrol, software for laboratory equipment control for scientific experiments.</span>
<span class="c1"># Copyright (C) &lt;2016&gt;  Arthur Safira, Jan Gieseler, Aaron Kabcenell</span>
<span class="c1">#</span>
<span class="c1"># pylabcontrol is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># pylabcontrol is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with pylabcontrol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">PyQt5.uic</span> <span class="k">import</span> <span class="n">loadUiType</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSlot</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="k">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>

<span class="kn">from</span> <span class="nn">pylabcontrol.core</span> <span class="k">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Instrument</span><span class="p">,</span> <span class="n">Script</span><span class="p">,</span> <span class="n">Probe</span>
<span class="kn">from</span> <span class="nn">pylabcontrol.core.script_iterator</span> <span class="k">import</span> <span class="n">ScriptIterator</span>
<span class="kn">from</span> <span class="nn">pylabcontrol.core.read_probes</span> <span class="k">import</span> <span class="n">ReadProbes</span>
<span class="kn">from</span> <span class="nn">pylabcontrol.gui.windows_and_widgets</span> <span class="k">import</span> <span class="n">B26QTreeItem</span><span class="p">,</span> <span class="n">MatplotlibWidget</span><span class="p">,</span> <span class="n">LoadDialog</span><span class="p">,</span> <span class="n">LoadDialogProbes</span><span class="p">,</span> <span class="n">ExportDialog</span>
<span class="kn">from</span> <span class="nn">pylabcontrol.scripts.select_points</span> <span class="k">import</span> <span class="n">SelectPoints</span>
<span class="kn">from</span> <span class="nn">pylabcontrol.core.read_write_functions</span> <span class="k">import</span> <span class="n">load_b26_file</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">webbrowser</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>




<span class="c1"># load the basic old_gui either from .ui file or from precompiled .py file</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">)))</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ui_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s1">&#39;ui_files&#39;</span><span class="p">,</span> <span class="s1">&#39;basic_application_window.ui&#39;</span><span class="p">))</span>
    <span class="n">Ui_MainWindow</span><span class="p">,</span> <span class="n">QMainWindow</span> <span class="o">=</span> <span class="n">loadUiType</span><span class="p">(</span><span class="n">ui_file_path</span><span class="p">)</span> <span class="c1"># with this we don&#39;t have to convert the .ui file into a python file!</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
    <span class="c1"># load precompiled old_gui, to complite run pyqt_uic basic_application_window.ui -o basic_application_window.py</span>
    <span class="kn">from</span> <span class="nn">pylabcontrol.gui.compiled_ui_files.basic_application_window</span> <span class="k">import</span> <span class="n">Ui_MainWindow</span>
    <span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMainWindow</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: on-the-fly conversion of basic_application_window.ui file failed, loaded .py file instead.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="CustomEventFilter"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.CustomEventFilter">[docs]</a><span class="k">class</span> <span class="nc">CustomEventFilter</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
<div class="viewcode-block" id="CustomEventFilter.eventFilter"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.CustomEventFilter.eventFilter">[docs]</a>    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">QEvent</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">QEvent</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">Wheel</span><span class="p">):</span>
            <span class="n">QEvent</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="n">eventFilter</span><span class="p">(</span><span class="n">QObject</span><span class="p">,</span> <span class="n">QEvent</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">Ui_MainWindow</span><span class="p">):</span>
    <span class="n">application_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s1">&#39;pylabcontrol&#39;</span><span class="p">,</span> <span class="s1">&#39;user_data&#39;</span><span class="p">))</span>

    <span class="n">_DEFAULT_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data_folder&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">application_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
        <span class="s2">&quot;probes_folder&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">application_path</span><span class="p">,</span><span class="s2">&quot;probes_auto_generated&quot;</span><span class="p">),</span>
        <span class="s2">&quot;instrument_folder&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">application_path</span><span class="p">,</span> <span class="s2">&quot;instruments_auto_generated&quot;</span><span class="p">),</span>
        <span class="s2">&quot;scripts_folder&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">application_path</span><span class="p">,</span> <span class="s2">&quot;scripts_auto_generated&quot;</span><span class="p">),</span>
        <span class="s2">&quot;probes_log_folder&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">application_path</span><span class="p">,</span> <span class="s2">&quot;b26_tmp&quot;</span><span class="p">),</span>
        <span class="s2">&quot;settings_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">application_path</span><span class="p">,</span> <span class="s2">&quot;pythonlab_config&quot;</span><span class="p">)</span>
    <span class="p">}</span>


    <span class="n">startup_msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n\</span>
<span class="s1">    ======================================================</span><span class="se">\n\</span>
<span class="s1">    =============== Starting B26 Python LAB  =============</span><span class="se">\n\</span>
<span class="s1">    ======================================================</span><span class="se">\n\n</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MainWindow(intruments, scripts, probes)</span>
<span class="sd">            - intruments: depth 1 dictionary where keys are instrument names and keys are instrument classes</span>
<span class="sd">            - scripts: depth 1 dictionary where keys are script names and keys are script classes</span>
<span class="sd">            - probes: depth 1 dictionary where to be decided....?</span>

<span class="sd">        MainWindow(settings_file)</span>
<span class="sd">            - settings_file is the path to a json file that contains all the settings for the old_gui</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setup_trees</span><span class="p">():</span>
            <span class="c1"># COMMENT_ME</span>

            <span class="c1"># define data container</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># history of executed commands</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history_model</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_history</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_history</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_history</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_tree_item</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probe_to_plot</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># create models for tree structures, the models reflect the data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset_model</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset_model</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;name (tag)&#39;</span><span class="p">,</span> <span class="s1">&#39;type (script)&#39;</span><span class="p">])</span>

            <span class="c1"># create models for tree structures, the models reflect the data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings_model</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings_model</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s1">&#39;parameter&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">connect_controls</span><span class="p">():</span>
            <span class="c1"># COMMENT_ME</span>
            <span class="c1"># =============================================================</span>
            <span class="c1"># ===== LINK WIDGETS TO FUNCTIONS =============================</span>
            <span class="c1"># =============================================================</span>

            <span class="c1"># link buttons to old_functions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_start_script</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_stop_script</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_skip_subscript</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_validate_script</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="c1"># self.btn_plot_script.clicked.connect(self.btn_clicked)</span>
            <span class="c1"># self.btn_plot_probe.clicked.connect(self.btn_clicked)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_store_script_data</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="c1"># self.btn_plot_data.clicked.connect(self.btn_clicked)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_save_data</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_delete_data</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">btn_save_gui</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_gui</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_about</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_exit</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">actionSave</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actionExport</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actionGo_to_pylabcontrol_GitHub_page</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_instruments</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_scripts</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_probes</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>

            <span class="c1"># Helper function to make only column 1 editable</span>
            <span class="k">def</span> <span class="nf">onScriptParamClick</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">treeWidget</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Script</span><span class="p">,</span> <span class="n">Instrument</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">is_point</span><span class="p">():</span>
                    <span class="c1"># self.tree_scripts.editItem(item, column)</span>
                    <span class="n">tree</span><span class="o">.</span><span class="n">editItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>

            <span class="c1"># tree structures</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">onScriptParamClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentItem</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentColumn</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>
            <span class="c1"># self.tree_scripts.installEventFilter(self)</span>
            <span class="c1"># QtWidgets.QTreeWidget.installEventFilter(self)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_tab</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">onScriptParamClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">currentItem</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">currentColumn</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">itemExpanded</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_instruments</span><span class="p">())</span>


            <span class="c1"># set the log_filename when checking loggin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chk_probe_log</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_probe_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chk_probe_log</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chk_probe_plot</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_clicked</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chk_show_all</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_hide_parameter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_figures</span><span class="p">()</span>


        <span class="c1"># create a &quot;delegate&quot; --- an editor that uses our new Editor Factory when creating editors,</span>
        <span class="c1"># and use that for tree_scripts</span>
        <span class="c1"># needed to avoid rounding of numbers</span>
        <span class="n">delegate</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QStyledItemDelegate</span><span class="p">()</span>
        <span class="n">new_factory</span> <span class="o">=</span> <span class="n">CustomEditorFactory</span><span class="p">()</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">setItemEditorFactory</span><span class="p">(</span><span class="n">new_factory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">delegate</span><span class="p">)</span>
        <span class="n">setup_trees</span><span class="p">()</span>

        <span class="n">connect_controls</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_to_config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s1">&#39;save_config.json&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_to_config</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">path_to_config</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_config</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;last_save_path&#39;</span> <span class="ow">in</span> <span class="n">config_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;last_save_path&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Checking for previous save of GUI here: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Could not find previous save of GUI here: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Starting with blank GUI&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="n">filepath</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Could not find file given to open --- starting with a blank GUI&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scripts_folder&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;data_folder&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># todo: load datasets from tmp folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span> <span class="o">=</span> <span class="n">ReadProbes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># always show the script tab</span>

        <span class="c1"># == create a thread for the scripts ==</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_progress_update</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used to keep track of status updates, to block updates when they occur to often</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chk_show_all</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionSave</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QKeySequence</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionExport</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Ctrl+E&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_history</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

<div class="viewcode-block" id="MainWindow.closeEvent"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        things to be done when gui closes, like save the settings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">script_thread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">======================================================&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================= Closing B26 Python LAB =============&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======================================================</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.eventFilter"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.eventFilter">[docs]</a>    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        TEMPORARY / UNDER DEVELOPMENT</span>

<span class="sd">        THIS IS TO ALLOW COPYING OF PARAMETERS VIA DRAP AND DROP</span>

<span class="sd">        Args:</span>
<span class="sd">            object:</span>
<span class="sd">            event:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">object</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">):</span>
            <span class="c1"># print(&#39;XXXXXXX = event in scripts&#39;, event.type(),</span>
            <span class="c1">#       QtCore.QEvent.DragEnter, QtCore.QEvent.DragMove, QtCore.QEvent.DragLeave)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">ChildAdded</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Script</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ONLY SCRIPTS CAN BE DRAGGED&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;XXX ChildAdded&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>



                <span class="c1"># if event.mimeData().hasUrls():</span>
                <span class="c1">#     event.accept()  # must accept the dragEnterEvent or else the dropEvent can&#39;t occur !!!</span>
                <span class="c1">#     print &quot;accept&quot;</span>
                <span class="c1"># else:</span>
                <span class="c1">#     event.ignore()</span>
                <span class="c1">#     print &quot;ignore&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">ChildRemoved</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;XXX ChildRemoved&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">Drop</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XXX Drop&#39;</span><span class="p">)</span>
                <span class="c1"># if event.mimeData().hasUrls():  # if file or link is dropped</span>
                <span class="c1">#     urlcount = len(event.mimeData().urls())  # count number of drops</span>
                <span class="c1">#     url = event.mimeData().urls()[0]  # get first url</span>
                <span class="c1">#     object.setText(url.toString())  # assign first url to editline</span>
                <span class="c1">#     # event.accept()  # doesnt appear to be needed</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># lets the event continue to the edit</span>

        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="MainWindow.set_probe_file_name"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.set_probe_file_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_probe_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets the filename to which the probe logging function will write</span>
<span class="sd">        Args:</span>
<span class="sd">            checked: boolean (True: opens file) (False: closes file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;probes_log_folder&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_probes.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">-%H_%M_%S&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">probe_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">probes_values</span>
                <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> (</span><span class="si">{:s}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">instr</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span> <span class="k">for</span> <span class="n">instr</span><span class="p">,</span> <span class="n">p_dict</span> <span class="ow">in</span> <span class="n">new_values</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">probe_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probe_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="MainWindow.switch_tab"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.switch_tab">[docs]</a>    <span class="k">def</span> <span class="nf">switch_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        takes care of the action that happen when switching between tabs</span>
<span class="sd">        e.g. activates and deactives probes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_tab</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_tab</span> <span class="o">==</span> <span class="s1">&#39;Probes&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_probes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="n">current_tab</span> <span class="o">==</span> <span class="s1">&#39;Instruments&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_instruments</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;updating probes / instruments disabled while script is running!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.refresh_instruments"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.refresh_instruments">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_instruments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if self.tree_settings has been expanded, ask instruments for their actual values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">list_access_nested_dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">somelist</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Allows one to use a list to access a nested dictionary, for example:</span>
<span class="sd">            listAccessNestedDict({&#39;a&#39;: {&#39;b&#39;: 1}}, [&#39;a&#39;, &#39;b&#39;]) returns 1</span>
<span class="sd">            Args:</span>
<span class="sd">                dict:</span>
<span class="sd">                somelist:</span>

<span class="sd">            Returns:</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">getitem</span><span class="p">,</span> <span class="n">somelist</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">instrument</span><span class="p">,</span> <span class="n">path_to_instrument</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_instrument</span><span class="p">()</span>
                        <span class="n">path_to_instrument</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span> <span class="c1">#check if item is in probes</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="n">path_to_instrument</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span> <span class="c1">#if item not in probes, get value from settings instead</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">list_access_nested_dict</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">path_to_instrument</span><span class="p">)</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="c1">#need to block signals during update so that tree.itemChanged doesn&#39;t fire and the gui doesn&#39;t try to</span>
        <span class="c1">#reupdate the instruments to their current value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
            <span class="n">instrument</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">update</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="MainWindow.plot_clicked"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.plot_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">plot_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets activated when the user clicks on a plot</span>
<span class="sd">        Args:</span>
<span class="sd">            mouse_event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="p">,</span> <span class="n">SelectPoints</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">mouse_event</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">toggle_NV</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">figure</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_point</span><span class="p">():</span>
                <span class="n">item_x</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">item_x</span><span class="p">)</span>
                    <span class="n">item_x</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
                    <span class="n">item_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:0.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)))</span>
                <span class="n">item_y</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mouse_event</span><span class="o">.</span><span class="n">ydata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">item_y</span><span class="p">)</span>
                    <span class="n">item_y</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
                    <span class="n">item_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:0.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)))</span>

                <span class="c1"># focus back on item</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">is_point</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">xdata</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">mouse_event</span><span class="o">.</span><span class="n">ydata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindow.get_time"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.get_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns: the current time as a formated string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.log"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        log function</span>
<span class="sd">        Args:</span>
<span class="sd">            msg: the text message to be logged</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:s}</span><span class="se">\t</span><span class="s2"> </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_model</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindow.create_figures"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.create_figures">[docs]</a>    <span class="k">def</span> <span class="nf">create_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates the maplotlib figures]</span>
<span class="sd">        self.matplotlibwidget_1</span>
<span class="sd">        self.matplotlibwidget_2</span>
<span class="sd">        and toolbars</span>
<span class="sd">        self.mpl_toolbar_1</span>
<span class="sd">        self.mpl_toolbar_2</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_14</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_15</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span> <span class="o">=</span> <span class="n">MatplotlibWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_2</span><span class="p">)</span>
        <span class="n">sizePolicy</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">sizePolicy</span><span class="o">.</span><span class="n">setHorizontalStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sizePolicy</span><span class="o">.</span><span class="n">setVerticalStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sizePolicy</span><span class="o">.</span><span class="n">setHeightForWidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">sizePolicy</span><span class="p">()</span><span class="o">.</span><span class="n">hasHeightForWidth</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">sizePolicy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;matplotlibwidget_2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_16</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span> <span class="o">=</span> <span class="n">MatplotlibWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;matplotlibwidget_1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_15</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_clicked</span><span class="p">)</span>

        <span class="c1"># adds a toolbar to the plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_toolbar_1</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar_space_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_toolbar_2</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar_space_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_9</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpl_toolbar_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_14</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpl_toolbar_1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.load_scripts"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.load_scripts">[docs]</a>    <span class="k">def</span> <span class="nf">load_scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            opens file dialog to load scripts into gui</span>
<span class="sd">            &quot;&quot;&quot;</span>


            <span class="c1"># update scripts so that current settings do not get lost</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
                <span class="n">script_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_script_from_item</span><span class="p">(</span><span class="n">script_item</span><span class="p">)</span>


            <span class="n">dialog</span> <span class="o">=</span> <span class="n">LoadDialog</span><span class="p">(</span><span class="n">elements_type</span><span class="o">=</span><span class="s2">&quot;scripts&quot;</span><span class="p">,</span> <span class="n">elements_old</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">,</span>
                                <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;scripts_folder&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;scripts_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">txt_probe_log_path</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">scripts</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
                <span class="n">added_scripts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scripts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">removed_scripts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">scripts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="k">if</span> <span class="s1">&#39;data_folder&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">]):</span>
                    <span class="n">data_folder_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_folder_name</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># create instances of new instruments/scripts</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">,</span> <span class="n">loaded_failed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">Script</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">(</span>
                    <span class="n">script_dict</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">scripts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">added_scripts</span><span class="p">},</span>
                    <span class="n">scripts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">,</span>
                    <span class="n">instruments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span>
                    <span class="n">log_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_folder_name</span><span class="p">)</span>

                <span class="c1"># delete instances of new instruments/scripts that have been deselected</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">removed_scripts</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="MainWindow.btn_clicked"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.btn_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">btn_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        slot to which connect buttons</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probe_to_plot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">start_button</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            starts the selected script</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>

            <span class="c1"># BROKEN 20170109: repeatedly erases updates to gui</span>
            <span class="c1"># self.expanded_items = []</span>
            <span class="c1"># for index in range(self.tree_scripts.topLevelItemCount()):</span>
            <span class="c1">#     someitem = self.tree_scripts.topLevelItem(index)</span>
            <span class="c1">#     if someitem.isExpanded():</span>
            <span class="c1">#         self.expanded_items.append(someitem.name)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">script_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>


            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get script and update settings from tree</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">running_item</span> <span class="o">=</span> <span class="n">item</span>
                <span class="n">script</span><span class="p">,</span> <span class="n">path_to_script</span><span class="p">,</span> <span class="n">script_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_script</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">update_script_from_item</span><span class="p">(</span><span class="n">script_item</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;starting </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

                <span class="c1"># put script onto script thread</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================================================&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;===== starting </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================================================&#39;</span><span class="p">)</span>
                <span class="n">script_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_thread</span>

                <span class="k">def</span> <span class="nf">move_to_worker_thread</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>

                    <span class="n">script</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">script_thread</span><span class="p">)</span>

                    <span class="c1"># move also the subscript to the worker thread</span>
                    <span class="k">for</span> <span class="n">subscript</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                        <span class="n">move_to_worker_thread</span><span class="p">(</span><span class="n">subscript</span><span class="p">)</span>

                <span class="n">move_to_worker_thread</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

                <span class="n">script</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">)</span> <span class="c1"># connect update signal of script to update slot of gui</span>
                <span class="n">script_thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">run</span><span class="p">)</span> <span class="c1"># causes the script to start upon starting the thread</span>
                <span class="n">script</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">script_thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>  <span class="c1"># clean up. quit thread after script is finished</span>
                <span class="n">script</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_finished</span><span class="p">)</span> <span class="c1"># connect finished signal of script to finished slot of gui</span>

                <span class="c1"># start thread, i.e. script</span>
                <span class="n">script_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span> <span class="o">=</span> <span class="n">script</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btn_start_script</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># self.tabWidget.setEnabled(False)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="p">,</span> <span class="n">ScriptIterator</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btn_skip_subscript</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;User tried to run a script without one selected.&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">stop_button</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            stops the current script</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;User clicked stop, but there isn</span><span class="se">\&#39;</span><span class="s1">t anything running...this is awkward. Re-enabling start button anyway.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_start_script</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">skip_button</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Skips to the next script if the current script is a Iterator script</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">is_running</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="p">,</span>
                                                                                                 <span class="n">ScriptIterator</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span><span class="o">.</span><span class="n">skip_next</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;User clicked skip, but there isn</span><span class="se">\&#39;</span><span class="s1">t a iterator script running...this is awkward.&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">validate_button</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            validates the selected script</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">script</span><span class="p">,</span> <span class="n">path_to_script</span><span class="p">,</span> <span class="n">script_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_script</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_script_from_item</span><span class="p">(</span><span class="n">script_item</span><span class="p">)</span>
                <span class="n">script</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
                <span class="n">script</span><span class="o">.</span><span class="n">plot_validate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">figure</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">store_script_data</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            updates the internal self.data_sets with selected script and updates tree self.fill_dataset_tree</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">script</span><span class="p">,</span> <span class="n">path_to_script</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_script</span><span class="p">()</span>
                <span class="n">script_copy</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">duplicate</span><span class="p">()</span>
                <span class="n">time_tag</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">-%H_%M_%S&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">time_tag</span> <span class="p">:</span> <span class="n">script_copy</span><span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">fill_dataset_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">save_data</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">            saves the selected script (where is contained in the script itself)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">indecies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">indecies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indecies</span><span class="p">]))</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">time_tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">name_tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">]</span>
                <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span><span class="p">[</span><span class="n">time_tag</span><span class="p">]</span>
                <span class="n">script</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;tag&#39;</span> <span class="p">:</span> <span class="n">name_tag</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">})</span>
                <span class="n">script</span><span class="o">.</span><span class="n">save_data</span><span class="p">()</span>
                <span class="n">script</span><span class="o">.</span><span class="n">save_image_to_disk</span><span class="p">()</span>
                <span class="n">script</span><span class="o">.</span><span class="n">save_b26</span><span class="p">()</span>
                <span class="n">script</span><span class="o">.</span><span class="n">save_log</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">delete_data</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            deletes the data from the dataset</span>
<span class="sd">            Returns:</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">indecies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">indecies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indecies</span><span class="p">]))</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">time_tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span><span class="p">[</span><span class="n">time_tag</span><span class="p">]</span>

                <span class="n">model</span><span class="o">.</span><span class="n">removeRows</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">load_probes</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            opens file dialog to load probes into gui</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># if the probe has never been started it can not be disconnected so we catch that error</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
                <span class="c1"># self.read_probes.stop()</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">LoadDialogProbes</span><span class="p">(</span><span class="n">probes_old</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;probes_folder&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;probes_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">txt_probe_log_path</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">probes</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
                <span class="n">added_instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">probes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="n">removed_instruments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">probes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="c1"># create instances of new probes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="p">,</span> <span class="n">loaded_failed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">Probe</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">(</span>
                    <span class="n">probe_dict</span><span class="o">=</span><span class="n">probes</span><span class="p">,</span>
                    <span class="n">probes</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">instruments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">loaded_failed</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;WARNING following probes could not be loaded&#39;</span><span class="p">,</span> <span class="n">loaded_failed</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loaded_failed</span><span class="p">)))</span>


                <span class="c1"># restart the readprobes thread</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span> <span class="o">=</span> <span class="n">ReadProbes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1"># clear tree because the probe might have changed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_probes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">load_instruments</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            opens file dialog to load instruments into gui</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;instrument_folder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">:</span>
                <span class="n">dialog</span> <span class="o">=</span> <span class="n">LoadDialog</span><span class="p">(</span><span class="n">elements_type</span><span class="o">=</span><span class="s2">&quot;instruments&quot;</span><span class="p">,</span> <span class="n">elements_old</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;instrument_folder&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">dialog</span> <span class="o">=</span> <span class="n">LoadDialog</span><span class="p">(</span><span class="n">elements_type</span><span class="o">=</span><span class="s2">&quot;instruments&quot;</span><span class="p">,</span> <span class="n">elements_old</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;instrument_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">txt_probe_log_path</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">instruments</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
                <span class="n">added_instruments</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">instruments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">removed_instruments</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">instruments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="c1"># print(&#39;added_instruments&#39;, {name: instruments[name] for name in added_instruments})</span>

                <span class="c1"># create instances of new instruments</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span> <span class="n">loaded_failed</span> <span class="o">=</span> <span class="n">Instrument</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">instruments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">added_instruments</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loaded_failed</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;WARNING following instrument could not be loaded&#39;</span><span class="p">,</span> <span class="n">loaded_failed</span><span class="p">))</span>
                <span class="c1"># delete instances of new instruments/scripts that have been deselected</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">removed_instruments</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">sender</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            plots the data of the selected script</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
                <span class="n">time_tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span><span class="p">[</span><span class="n">time_tag</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">script</span><span class="p">,</span> <span class="n">path_to_script</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_script</span><span class="p">()</span>
                <span class="c1"># only plot if script has been selected but not if a parameter has been selected</span>
                <span class="k">if</span> <span class="n">path_to_script</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_start_script</span><span class="p">:</span>
            <span class="n">start_button</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_stop_script</span><span class="p">:</span>
            <span class="n">stop_button</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_skip_subscript</span><span class="p">:</span>
            <span class="n">skip_button</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_validate_script</span><span class="p">:</span>
            <span class="n">validate_button</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">):</span>
            <span class="n">plot_data</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_store_script_data</span><span class="p">:</span>
            <span class="n">store_script_data</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_save_data</span><span class="p">:</span>
            <span class="n">save_data</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_delete_data</span><span class="p">:</span>
            <span class="n">delete_data</span><span class="p">()</span>
        <span class="c1"># elif sender is self.btn_plot_probe:</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk_probe_plot</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk_probe_plot</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="p">:</span>
                        <span class="c1">#selected item is an instrument not a probe, maybe plot all the probes...</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t plot, No probe selected. Select probe and try again!&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">instrument</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">probe_to_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t plot, No probe selected. Select probe and try again!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">probe_to_plot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_save_gui</span><span class="p">:</span>
            <span class="c1"># get filename</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Save gui settings to file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">])</span> <span class="c1"># filter = &#39;.b26gui&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_gui</span><span class="p">:</span>
            <span class="c1"># get filename</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Load gui settings from file&#39;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">])</span>
            <span class="c1"># self.load_settings(fname)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_about</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;pylabcontrol: Laboratory Equipment Control for Scientific Experiments&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s2">&quot;This software was developed by Arthur Safira, Jan Gieseler, and Aaron Kabcenell at&quot;</span>
                                   <span class="s2">&quot;Harvard University. It is licensed under the LPGL licence. For more information,&quot;</span>
                                   <span class="s2">&quot;visit the GitHub page at github.com/LISE-B26/pylabcontrol .&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;About&quot;</span><span class="p">)</span>
            <span class="c1"># msg.setDetailedText(&quot;some stuff&quot;)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="c1"># msg.buttonClicked.connect(msgbtn)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="c1"># elif (sender is self.btn_load_instruments) or (sender is self.btn_load_scripts):</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_load_instruments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_scripts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_probes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_instruments</span><span class="p">:</span>
                <span class="n">load_instruments</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_scripts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_scripts</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">btn_load_probes</span><span class="p">:</span>
                <span class="n">load_probes</span><span class="p">()</span>
            <span class="c1"># refresh trees</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">actionSave</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">actionGo_to_pylabcontrol_GitHub_page</span><span class="p">:</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;https://github.com/LISE-B26/pylabcontrol&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">actionExport</span><span class="p">:</span>
            <span class="n">export_dialog</span> <span class="o">=</span> <span class="n">ExportDialog</span><span class="p">()</span>
            <span class="n">export_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_show_hide_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        shows or hides parameters</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">(),</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">),</span> <span class="s1">&#39;this function should be connected to a check box&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">iterator</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItemIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItemIterator</span><span class="o">.</span><span class="n">Hidden</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">iterator</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">iterator</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItemIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItemIterator</span><span class="o">.</span><span class="n">NotHidden</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">iterator</span> <span class="o">+=</span><span class="mi">1</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<div class="viewcode-block" id="MainWindow.update_parameters"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.update_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">treeWidget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        updates the internal dictionaries for scripts and instruments with values from the respective trees</span>

<span class="sd">        treeWidget: the tree from which to update</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">treeWidget</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="p">:</span>

            <span class="n">item</span> <span class="o">=</span> <span class="n">treeWidget</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>



            <span class="n">instrument</span><span class="p">,</span> <span class="n">path_to_instrument</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_instrument</span><span class="p">()</span>

            <span class="c1"># build nested dictionary to update instrument</span>
            <span class="n">dictator</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path_to_instrument</span><span class="p">:</span>
                <span class="n">dictator</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="n">dictator</span><span class="p">}</span>

            <span class="c1"># get old value from instrument</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">settings</span>
            <span class="n">path_to_instrument</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path_to_instrument</span><span class="p">:</span>
                <span class="n">old_value</span> <span class="o">=</span> <span class="n">old_value</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

            <span class="c1"># send new value from tree to instrument</span>
            <span class="n">instrument</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictator</span><span class="p">)</span>

            <span class="n">new_value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">new_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">old_value</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;changed parameter </span><span class="si">{:s}</span><span class="s2"> from </span><span class="si">{:s}</span><span class="s2"> to </span><span class="si">{:s}</span><span class="s2"> on </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">old_value</span><span class="p">),</span>
                                                                                <span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">),</span> <span class="n">instrument</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;did not change parameter </span><span class="si">{:s}</span><span class="s2"> on </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">treeWidget</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">:</span>

            <span class="n">item</span> <span class="o">=</span> <span class="n">treeWidget</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">path_to_script</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_script</span><span class="p">()</span>

            <span class="c1"># check if changes value is from an instrument</span>
            <span class="n">instrument</span><span class="p">,</span> <span class="n">path_to_instrument</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_instrument</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">instrument</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">new_value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>


                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;changed parameter </span><span class="si">{:s}</span><span class="s2"> to </span><span class="si">{:s}</span><span class="s2"> in </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                                                <span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">),</span>
                                                                                <span class="n">script</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;changed parameter </span><span class="si">{:s}</span><span class="s2"> to </span><span class="si">{:s}</span><span class="s2"> in </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                                            <span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">),</span>
                                                                            <span class="n">script</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.plot_script"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.plot_script">[docs]</a>    <span class="k">def</span> <span class="nf">plot_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the plot function of the script, and redraws both plots</span>
<span class="sd">        Args:</span>
<span class="sd">            script: script to be plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">script</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">figure</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>


<div class="viewcode-block" id="MainWindow.update_status"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.update_status">[docs]</a>    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        waits for a signal emitted from a thread and updates the gui</span>
<span class="sd">        Args:</span>
<span class="sd">            progress:</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># interval at which the gui will be updated, if requests come in faster than they will be ignored</span>
        <span class="n">update_interval</span> <span class="o">=</span> <span class="mf">0.2</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_progress_update</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">now</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_progress_update</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">update_interval</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_last_progress_update</span> <span class="o">=</span> <span class="n">now</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>

        <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span>

        <span class="c1"># Estimate remaining time if progress has been made</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">remaining_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">script</span><span class="o">.</span><span class="n">remaining_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_time_estimate</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;time remaining: </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">remaining_time</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">script</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;scripts&#39;</span><span class="p">,</span> <span class="s1">&#39;instruments&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span></div>


<div class="viewcode-block" id="MainWindow.script_finished"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.script_finished">[docs]</a>    <span class="nd">@pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">script_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        waits for the script to emit the script_finshed signal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span>
        <span class="n">script</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">script</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_script</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_start_script</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_skip_subscript</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.plot_script_validate"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.plot_script_validate">[docs]</a>    <span class="k">def</span> <span class="nf">plot_script_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks the plottype of the script and plots it accordingly</span>
<span class="sd">        Args:</span>
<span class="sd">            script: script to be plotted</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">script</span><span class="o">.</span><span class="n">plot_validate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">figure</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_2</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindow.update_probes"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.update_probes">[docs]</a>    <span class="k">def</span> <span class="nf">update_probes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update the probe tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">probes_values</span>
        <span class="n">probe_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_probes</span><span class="o">.</span><span class="n">probes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">probe_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">():</span>
            <span class="c1"># when run for the first time, there are no probes in the tree, so we have to fill it first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fill_treewidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="p">,</span> <span class="n">new_values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">probe_count</span><span class="p">):</span>
                <span class="n">topLvlItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_probes</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topLvlItem</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="n">topLvlItem</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_values</span><span class="p">[</span><span class="n">topLvlItem</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_to_plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probe_to_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplotlibwidget_1</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk_probe_log</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span> <span class="k">for</span> <span class="n">instr</span><span class="p">,</span> <span class="n">p_dict</span> <span class="ow">in</span> <span class="n">new_values</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probe_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindow.update_script_from_item"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.update_script_from_item">[docs]</a>    <span class="k">def</span> <span class="nf">update_script_from_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        updates the script based on the information provided in item</span>

<span class="sd">        Args:</span>
<span class="sd">            script: script to be updated</span>
<span class="sd">            item: B26QTreeItem that contains the new settings of the script</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">script</span><span class="p">,</span> <span class="n">path_to_script</span><span class="p">,</span> <span class="n">script_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_script</span><span class="p">()</span>

        <span class="c1"># build dictionary</span>
        <span class="c1"># get full information from script</span>
        <span class="n">dictator</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">script_item</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># there is only one item in the dictionary</span>

        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># update instrument</span>
            <span class="n">script</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;settings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictator</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;settings&#39;</span><span class="p">]</span>
            <span class="c1"># remove instrument</span>
            <span class="k">del</span> <span class="n">dictator</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>


        <span class="k">for</span> <span class="n">sub_script_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">sub_script_item</span> <span class="o">=</span> <span class="n">script_item</span><span class="o">.</span><span class="n">get_subscript</span><span class="p">(</span><span class="n">sub_script_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_script_from_item</span><span class="p">(</span><span class="n">sub_script_item</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">dictator</span><span class="p">[</span><span class="n">sub_script_name</span><span class="p">]</span>

        <span class="n">script</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictator</span><span class="p">)</span>
        <span class="c1"># update datefolder path</span>
        <span class="n">script</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="MainWindow.fill_treewidget"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.fill_treewidget">[docs]</a>    <span class="k">def</span> <span class="nf">fill_treewidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fills a QTreeWidget with nested parameters, in future replace QTreeWidget with QTreeView and call fill_treeview</span>
<span class="sd">        Args:</span>
<span class="sd">            tree: QtWidgets.QTreeWidget</span>
<span class="sd">            parameters: dictionary or Parameter object</span>
<span class="sd">            show_all: boolean if true show all parameters, if false only selected ones</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                <span class="n">B26QTreeItem</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">valid_values</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">parameters</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">B26QTreeItem</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.fill_treeview"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.fill_treeview">[docs]</a>    <span class="k">def</span> <span class="nf">fill_treeview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fills a treeview with nested parameters</span>
<span class="sd">        Args:</span>
<span class="sd">            tree: QtWidgets.QTreeView</span>
<span class="sd">            parameters: dictionary or Parameter object</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">removeRows</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">child_name</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key_child</span><span class="p">,</span> <span class="n">value_child</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">add_element</span><span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">key_child</span><span class="p">,</span> <span class="n">value_child</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">child_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child_value</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

                <span class="n">item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">([</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_value</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sub_key</span><span class="p">,</span> <span class="n">sub_value</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">add_element</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">sub_key</span><span class="p">,</span> <span class="n">sub_value</span><span class="p">)</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">item_value</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">item_value</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">item_value</span><span class="o">.</span><span class="n">setSelectable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">appendRow</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="n">item_value</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindow.edit_tree_item"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.edit_tree_item">[docs]</a>    <span class="k">def</span> <span class="nf">edit_tree_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if sender is self.tree_gui_settings this will open a filedialog and ask for a filepath</span>
<span class="sd">        this filepath will be updated in the field of self.tree_gui_settings that has been double clicked</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">open_path_dialog</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            opens a file dialog to get the path to a file and</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">()</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">setFileMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">)</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Select a folder:&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">path</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">tree</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings</span><span class="p">:</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">open_path_dialog</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_treeview</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.refresh_tree"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.refresh_tree">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        refresh trees with current settings</span>
<span class="sd">        Args:</span>
<span class="sd">            tree: a QtWidgets.QTreeWidget object or a QtWidgets.QTreeView object</span>
<span class="sd">            items: dictionary or Parameter items with which to populate the tree</span>
<span class="sd">            show_all: boolean if true show all parameters, if false only selected ones</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tree</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span> <span class="ow">or</span> <span class="n">tree</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fill_treewidget</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">tree</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fill_treeview</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.fill_dataset_tree"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.fill_dataset_tree">[docs]</a>    <span class="k">def</span> <span class="nf">fill_dataset_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">data_sets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fills the tree with data sets where datasets is a dictionary of the form</span>
<span class="sd">        Args:</span>
<span class="sd">            tree:</span>
<span class="sd">            data_sets: a dataset</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">removeRows</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_sets</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">name</span>

            <span class="n">item_time</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">item_type</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>

            <span class="n">item_time</span><span class="o">.</span><span class="n">setSelectable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">item_time</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">item_type</span><span class="o">.</span><span class="n">setSelectable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">item_type</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">tree</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">appendRow</span><span class="p">([</span><span class="n">item_time</span><span class="p">,</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">item_type</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindow.load_config"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.load_config">[docs]</a>    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks if the file is a valid config file</span>
<span class="sd">        Args:</span>
<span class="sd">            filepath:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># load config or default if invalid</span>

        <span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            loads a old_gui settings file (a json dictionary)</span>
<span class="sd">            - path_to_file: path to file that contains the dictionary</span>

<span class="sd">            Returns:</span>
<span class="sd">                - instruments: depth 1 dictionary where keys are instrument names and values are instances of instruments</span>
<span class="sd">                - scripts:  depth 1 dictionary where keys are script names and values are instances of scripts</span>
<span class="sd">                - probes: depth 1 dictionary where to be decided....?</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">instruments_loaded</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">probes_loaded</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">scripts_loaded</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                <span class="n">in_data</span> <span class="o">=</span> <span class="n">load_b26_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

                <span class="n">instruments</span> <span class="o">=</span> <span class="n">in_data</span><span class="p">[</span><span class="s1">&#39;instruments&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;instruments&#39;</span> <span class="ow">in</span> <span class="n">in_data</span> <span class="k">else</span> <span class="p">{}</span>
                <span class="n">scripts</span> <span class="o">=</span> <span class="n">in_data</span><span class="p">[</span><span class="s1">&#39;scripts&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;scripts&#39;</span> <span class="ow">in</span> <span class="n">in_data</span> <span class="k">else</span> <span class="p">{}</span>
                <span class="n">probes</span> <span class="o">=</span> <span class="n">in_data</span><span class="p">[</span><span class="s1">&#39;probes&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;probes&#39;</span> <span class="ow">in</span> <span class="n">in_data</span> <span class="k">else</span> <span class="p">{}</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">instruments_loaded</span><span class="p">,</span> <span class="n">failed</span> <span class="o">=</span> <span class="n">Instrument</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;WARNING! Following instruments could not be loaded: &#39;</span><span class="p">,</span> <span class="n">failed</span><span class="p">))</span>

                    <span class="n">scripts_loaded</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">instruments_loaded</span> <span class="o">=</span> <span class="n">Script</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">(</span>
                        <span class="n">script_dict</span><span class="o">=</span><span class="n">scripts</span><span class="p">,</span>
                        <span class="n">instruments</span><span class="o">=</span><span class="n">instruments_loaded</span><span class="p">,</span>
                        <span class="n">log_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                        <span class="n">data_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">[</span><span class="s1">&#39;data_folder&#39;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;WARNING! Following scripts could not be loaded: &#39;</span><span class="p">,</span> <span class="n">failed</span><span class="p">))</span>

                    <span class="n">probes_loaded</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">instruments_loadeds</span> <span class="o">=</span> <span class="n">Probe</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">(</span>
                        <span class="n">probe_dict</span><span class="o">=</span><span class="n">probes</span><span class="p">,</span>
                        <span class="n">probes</span><span class="o">=</span><span class="n">probes_loaded</span><span class="p">,</span>
                        <span class="n">instruments</span><span class="o">=</span><span class="n">instruments_loaded</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Successfully loaded scripts and instruments from previous save.&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Could not load instruments or scripts from file.&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Opening with blank GUI.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">instruments_loaded</span><span class="p">,</span> <span class="n">scripts_loaded</span><span class="p">,</span> <span class="n">probes_loaded</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">load_b26_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="s1">&#39;gui_settings&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;settings_file&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">filepath</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span>
                <span class="s1">&#39;WARNING path to sett-ings file (</span><span class="si">{:s}</span><span class="s1">) in config file is different from path of settings file (</span><span class="si">{:s}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;settings_file&#39;</span><span class="p">],</span> <span class="n">filepath</span><span class="p">)))</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;settings_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;The filepath was invalid --- could not load settings. Loading blank GUI.&#39;</span><span class="p">)</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_CONFIG</span>


            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_CONFIG</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_CONFIG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;WARNING: failed validating or creating path: set to default path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_CONFIG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;WARNING: path </span><span class="si">{:s}</span><span class="s1"> not specified set to default </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="n">x</span><span class="p">])))</span>

        <span class="c1"># check if file_name is a valid filename</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)):</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;settings_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filepath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span> <span class="o">=</span> <span class="n">config</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probes</span> <span class="o">=</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_gui_settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_parameters</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_hide_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        hide the parameters that had been hidden</span>
<span class="sd">        Args:</span>
<span class="sd">            file_name: config file that has the information about which parameters are hidden</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">in_data</span> <span class="o">=</span> <span class="n">load_b26_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">in_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">set_item_visible</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">is_visible</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_visible</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">is_visible</span><span class="p">:</span>
                        <span class="n">set_item_visible</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">is_visible</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="n">is_visible</span>

        <span class="k">if</span> <span class="s2">&quot;scripts_hidden_parameters&quot;</span> <span class="ow">in</span> <span class="n">in_data</span><span class="p">:</span>
            <span class="c1"># consistency check</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">in_data</span><span class="p">[</span><span class="s2">&quot;scripts_hidden_parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">():</span>

                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="c1"># if item.name in in_data[&quot;scripts_hidden_parameters&quot;]:</span>
                    <span class="n">set_item_visible</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">in_data</span><span class="p">[</span><span class="s2">&quot;scripts_hidden_parameters&quot;</span><span class="p">][</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: settings for hiding parameters does</span><span class="se">\&#39;</span><span class="s1">t seem to match other settings&#39;</span><span class="p">)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     print(&#39;WARNING: no settings for hiding parameters all set to default&#39;)</span>

<div class="viewcode-block" id="MainWindow.save_config"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.save_config">[docs]</a>    <span class="k">def</span> <span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        saves gui configuration to out_file_name</span>
<span class="sd">        Args:</span>
<span class="sd">            filepath: name of file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_hidden_parameter</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>

            <span class="n">num_sub_elements</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">num_sub_elements</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dictator</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">visible</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dictator</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">:{}}</span>
                <span class="k">for</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sub_elements</span><span class="p">):</span>
                    <span class="n">dictator</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_hidden_parameter</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">child_id</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">dictator</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>

        <span class="c1"># build a dictionary for the configuration of the hidden parameters</span>
        <span class="n">dictator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
            <span class="n">script_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">dictator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_hidden_parameter</span><span class="p">(</span><span class="n">script_item</span><span class="p">))</span>

        <span class="n">dictator</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gui_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_settings</span><span class="p">,</span> <span class="s2">&quot;scripts_hidden_parameters&quot;</span><span class="p">:</span><span class="n">dictator</span><span class="p">}</span>

        <span class="c1"># update the internal dictionaries from the trees in the gui</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
            <span class="n">script_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_scripts</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_script_from_item</span><span class="p">(</span><span class="n">script_item</span><span class="p">)</span>

        <span class="n">dictator</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;instruments&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;scripts&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;probes&#39;</span><span class="p">:</span> <span class="p">{}})</span>

        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dictator</span><span class="p">[</span><span class="s1">&#39;instruments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dictator</span><span class="p">[</span><span class="s1">&#39;scripts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">probe_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dictator</span><span class="p">[</span><span class="s1">&#39;probes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">instrument</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">probe_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))})</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dictator</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">save_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s1">&#39;save_config.json&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_config_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">save_config_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s1">&#39;last_save_path&#39;</span><span class="p">:</span> <span class="n">filepath</span><span class="p">},</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">save_config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">save_config_file</span><span class="p">:</span>
                <span class="n">save_config_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;last_save_path&#39;</span><span class="p">:</span> <span class="n">filepath</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Saved GUI configuration&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MainWindow.save_dataset"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.MainWindow.save_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">save_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        saves current dataset to out_file_name</span>
<span class="sd">        Args:</span>
<span class="sd">            out_file_name: name of file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">time_tag</span><span class="p">,</span> <span class="n">script</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">script</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">.b26s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_tag</span><span class="p">)))</span></div></div>


<span class="c1"># In order to set the precision when editing floats, we need to override the default Editor widget that</span>
<span class="c1"># pops up over the text when you click. To do that, we create a custom Editor Factory so that the QTreeWidget</span>
<span class="c1"># uses the custom spinbox when editing floats</span>
<div class="viewcode-block" id="CustomEditorFactory"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.CustomEditorFactory">[docs]</a><span class="k">class</span> <span class="nc">CustomEditorFactory</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QItemEditorFactory</span><span class="p">):</span>
<div class="viewcode-block" id="CustomEditorFactory.createEditor"><a class="viewcode-back" href="../../../../code_docs/pylabcontrol.gui.windows_and_widgets.html#pylabcontrol.gui.windows_and_widgets.main_window.CustomEditorFactory.createEditor">[docs]</a>    <span class="k">def</span> <span class="nf">createEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">:</span>
            <span class="n">spin_box</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">QWidget</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">spin_box</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="o">.</span><span class="n">List</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="o">.</span><span class="n">StringList</span><span class="p">:</span>
            <span class="n">combo_box</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="n">QWidget</span><span class="p">)</span>
            <span class="n">combo_box</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">StrongFocus</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">combo_box</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CustomEditorFactory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createEditor</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Arthur Safira, Jan Gieseler, Aaron Kabcenell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>